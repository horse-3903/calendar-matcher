{% extends "base.html" %}
{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-50 via-white to-pink-50 dark:from-slate-900 dark:via-slate-950 dark:to-indigo-950">
  <main class="container mx-auto px-6 pt-16 pb-10">
    <div>
      <a href="/" class="inline-flex items-center text-sm text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-white mb-3 transition-colors">
        <svg class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none">
          <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Back to Dashboard
      </a>

      {% set member_count = members|length %}
      <div class="space-y-4">
        <div class="flex flex-col gap-4 rounded-2xl border border-gray-200 dark:border-slate-800 bg-white/80 dark:bg-slate-950/60 p-4">
          <div class="flex flex-wrap items-center gap-4">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                <span class="text-xl font-bold text-white">{{ group.name[0] }}</span>
              </div>
              <div>
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">{{ group.name }}</h1>
                <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-slate-300">
                  <span class="font-mono bg-gray-100 dark:bg-slate-800 px-2 py-0.5 rounded">
                    {{ group.join_code }}
                  </span>
                  <button class="p-1 rounded-full bg-purple-600 hover:bg-purple-700 text-white transition-colors flex items-center" data-copy-btn data-copy-value="{{ group.join_code }}">
                    <svg class="w-4 h-4 copy-icon" viewBox="0 0 24 24" fill="none">
                      <rect x="9" y="9" width="13" height="13" rx="2" stroke="currentColor" stroke-width="2"/>
                      <rect x="3" y="3" width="13" height="13" rx="2" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <svg class="w-4 h-4 hidden check-icon text-white" viewBox="0 0 24 24" fill="none">
                      <path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
            <div class="ml-auto flex flex-wrap gap-3">
              <button data-dialog-open="addTimeDialog" class="gap-2 px-4 py-2 rounded-full bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold inline-flex items-center">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none">
                  <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Add Available Time
              </button>
              <button data-dialog-open="proposalDialog" class="gap-2 px-4 py-2 rounded-full bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold inline-flex items-center">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none">
                  <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M22 2L15 22l-4-9-9-4 20-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Propose Meetup
              </button>
            </div>
          </div>
          <div class="grid gap-3 sm:grid-cols-3">
            <div class="rounded-xl border border-gray-200 dark:border-slate-800 bg-white dark:bg-slate-950 px-3 py-2.5">
              <p class="text-xs uppercase text-gray-500 dark:text-slate-400">Members</p>
              <p class="text-lg font-semibold text-gray-900 dark:text-white">{{ member_count }}</p>
            </div>
            <div class="rounded-xl border border-gray-200 dark:border-slate-800 bg-white dark:bg-slate-950 px-3 py-2.5">
              <p class="text-xs uppercase text-gray-500 dark:text-slate-400">Timezone</p>
              <p class="text-sm font-semibold text-gray-900 dark:text-white">{{ current_user.timezone or "GMT+00:00" }}</p>
            </div>
            <div class="rounded-xl border border-gray-200 dark:border-slate-800 bg-white dark:bg-slate-950 px-3 py-2.5">
              <p class="text-xs uppercase text-gray-500 dark:text-slate-400">Join Code</p>
              <p class="text-sm font-semibold text-gray-900 dark:text-white">{{ group.join_code }}</p>
            </div>
          </div>
        </div>

        <div class="grid gap-4 lg:grid-cols-[1.1fr_0.75fr_1.45fr]">
          <div class="bg-white dark:bg-slate-950 rounded-xl border border-gray-200 dark:border-slate-800 shadow-sm p-4">
            <div class="flex items-center gap-2 mb-3">
              <svg class="w-4 h-4 text-purple-600" viewBox="0 0 24 24" fill="none">
                <path d="M10 13a5 5 0 0 1 7 0l2 2a5 5 0 0 1-7 7l-1-1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M14 11a5 5 0 0 0-7 0L5 13a5 5 0 0 0 7 7l1-1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <span class="text-sm font-medium text-gray-900 dark:text-white">Invite Link</span>
            </div>
            <div class="flex gap-2 mb-3">
              <input id="inviteLink" value="" placeholder="Create an invite link" readOnly class="text-xs font-mono bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-lg px-3 py-2 w-full text-gray-600 dark:text-slate-300"/>
              <button class="px-3 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 text-white" onclick="copyInviteLink({{ group.id }}, this)">
                <svg class="w-4 h-4 copy-icon text-white" viewBox="0 0 24 24" fill="none">
                  <rect x="9" y="9" width="13" height="13" rx="2" stroke="currentColor" stroke-width="2"/>
                  <rect x="3" y="3" width="13" height="13" rx="2" stroke="currentColor" stroke-width="2"/>
                </svg>
                <svg class="w-4 h-4 hidden check-icon text-white" viewBox="0 0 24 24" fill="none">
                  <path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-xs text-gray-500 dark:text-slate-400">Expires in:</span>
              <select id="inviteDays" class="w-24 h-8 text-xs bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-md px-2 text-gray-700 dark:text-slate-200">
                <option value="1">1 day</option>
                <option value="3">3 days</option>
                <option value="7" selected>7 days</option>
                <option value="30">30 days</option>
              </select>
              <button class="px-3 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 text-white" onclick="createInvite({{ group.id }})">Create</button>
            </div>
          </div>

          <div class="bg-white dark:bg-slate-950 rounded-xl border border-gray-200 dark:border-slate-800 shadow-sm p-4">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-3">Legend</h3>
            <div class="grid gap-2 text-sm">
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded bg-purple-100 border border-purple-500"></div>
                <span class="text-gray-600 dark:text-slate-300">Available</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded bg-red-100 border border-red-500"></div>
                <span class="text-gray-600 dark:text-slate-300">Blocked</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded bg-orange-100 border border-orange-500"></div>
                <span class="text-gray-600 dark:text-slate-300">Proposed</span>
              </div>
            </div>
          </div>

          <div class="bg-white dark:bg-slate-950 rounded-xl border border-gray-200 dark:border-slate-800 shadow-sm p-4">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-sm font-semibold text-gray-900 dark:text-white">Members</h3>
              <span class="text-xs text-gray-500 dark:text-slate-400">{{ member_count }} total</span>
            </div>
            <div class="space-y-3">
              {% if members %}
                {% for u, m in members %}
                  <div class="flex items-center gap-3">
                    {% if u.profile_pic_url %}
                      <img src="{{ u.profile_pic_url }}" alt="Profile" class="w-8 h-8 rounded-full object-cover border border-purple-200 dark:border-purple-400/40"/>
                    {% else %}
                      <div class="w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-500/20 flex items-center justify-center text-purple-600 dark:text-purple-300 text-xs font-semibold">
                        {{ (u.display_name or u.name or "U")[0] }}
                      </div>
                    {% endif %}
                    <div class="flex-1">
                      <p class="text-sm font-medium text-gray-900 dark:text-white">{{ u.display_name or u.name }}</p>
                      <p class="text-xs text-gray-500 dark:text-slate-400">{{ u.email }}</p>
                    </div>
                    <span class="w-3 h-3 rounded-full" style="background: {{ m.color_hex }};"></span>
                  </div>
                {% endfor %}
              {% else %}
                <p class="text-sm text-gray-500 dark:text-slate-400">Invite teammates to see them here.</p>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-slate-950 rounded-xl border border-gray-200 dark:border-slate-800 shadow-sm p-4 sm:p-6">
          <div class="mb-4 flex flex-wrap items-center justify-between gap-3">
            <div>
              <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Shared Calendar</h2>
              <p class="text-sm text-gray-500 dark:text-slate-400">View availability across your group.</p>
            </div>
          </div>
          <div class="overflow-x-auto">
            <div class="min-w-[600px]">
              <div id="calendar" data-group-id="{{ group.id }}" data-demo="{{ '1' if demo_mode else '' }}" data-timezone="{{ current_user.timezone or '' }}"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<dialog id="addTimeDialog" class="dialog">
  <div class="dialog-card">
    <div class="dialog-header">
      <h3>Add Time Range</h3>
      <p>Add when you're available or block off times you're busy.</p>
    </div>
    <div class="dialog-body">
      <div class="flex gap-2">
        <button type="button" class="dialog-btn primary w-full" data-time-type="available" onclick="setTimeType('available')">Available</button>
        <button type="button" class="dialog-btn primary w-full" data-time-type="blocked" onclick="setTimeType('blocked')">Blocked</button>
      </div>
      <div>
        <label class="dialog-label" for="timeDate">Date</label>
        <input id="timeDate" type="date" class="dialog-input"/>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="dialog-label" for="timeStart">Start Time</label>
          <input id="timeStart" type="time" class="dialog-input"/>
        </div>
        <div>
          <label class="dialog-label" for="timeEnd">End Time</label>
          <input id="timeEnd" type="time" class="dialog-input"/>
        </div>
      </div>
      <button type="button" class="dialog-btn primary" onclick="submitAddTime({{ group.id }})">Add Time Range</button>
      <button type="button" class="dialog-btn ghost" data-dialog-close>Cancel</button>
    </div>
  </div>
</dialog>

<dialog id="proposalDialog" class="dialog">
  <div class="dialog-card">
    <div class="dialog-header">
      <h3>Propose a Meetup</h3>
      <p>Suggest a meeting time to your group.</p>
    </div>
    <div class="dialog-body">
      <div>
        <label class="dialog-label" for="proposalDate">Date</label>
        <input id="proposalDate" type="date" class="dialog-input"/>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="dialog-label" for="proposalStart">Start Time</label>
          <input id="proposalStart" type="time" class="dialog-input"/>
        </div>
        <div>
          <label class="dialog-label" for="proposalEnd">End Time</label>
          <input id="proposalEnd" type="time" class="dialog-input"/>
        </div>
      </div>
      <label class="dialog-label" for="meetLoc">Location</label>
      <input id="meetLoc" class="dialog-input" placeholder="e.g., Conference Room A, Zoom link"/>
      <label class="dialog-label" for="meetDesc">Description</label>
      <textarea id="meetDesc" class="dialog-input" rows="3" placeholder="What's this meeting about?"></textarea>
      <button type="button" class="dialog-btn primary" onclick="submitProposal({{ group.id }})">Send Proposal</button>
      <button type="button" class="dialog-btn ghost" data-dialog-close>Cancel</button>
    </div>
  </div>
</dialog>

<script>
  window.__GROUP_ID__ = {{ group.id }};
</script>
{% endblock %}

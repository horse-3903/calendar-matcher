<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{ title or "Calendar Matcher" }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
  <script>
    (function () {
      try {
        const stored = localStorage.getItem("theme");
        if (stored === "dark" || (!stored && window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
          document.documentElement.classList.add("dark");
        }
      } catch (e) {}
    })();
  </script>
  <link rel="stylesheet" href="/static/tailwind.css"/>
  <link rel="stylesheet" href="/static/styles.css"/>

  <!-- Schedule-X -->
  <link rel="stylesheet" href="/static/schedule-x.css"/>
</head>
<body class="min-h-screen font-sans bg-white text-gray-900 dark:bg-slate-950 dark:text-slate-100" data-demo="{{ '1' if demo_mode else '' }}" data-cal-debug="{{ '1' if config.APP_MODE == 'dev' else '' }}">
  {% set path = request.path %}
  {% set is_group_page = path.startswith('/groups') or path == '/demo/group' %}
  {% set is_dashboard_active = path == '/' %}
  {% set is_demo_active = path.startswith('/demo') %}
  {% set is_settings_active = path.startswith('/settings') %}
  {% set is_debug_active = path.startswith('/debug') %}
  {% set is_owner = current_user.is_authenticated and config.DEBUG_OWNER_EMAIL and current_user.email == config.DEBUG_OWNER_EMAIL %}
  {% set show_dev_console = (config.APP_MODE == 'dev') or (config.APP_MODE == 'prod' and is_owner) %}
  <header class="fixed top-0 left-0 right-0 z-50 bg-white/80 dark:bg-slate-950/80 backdrop-blur-md border-b border-gray-200/50 dark:border-slate-800/60">
    <nav class="container mx-auto px-6 flex items-center justify-between h-16">
      <a href="/" class="flex items-center gap-2 font-semibold text-lg">
        <span class="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
          <svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="none">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"></line>
            <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"></line>
            <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"></line>
          </svg>
        </span>
        <span class="text-gray-900 dark:text-white">Calendar Matcher</span>
      </a>

      <div class="hidden md:flex items-center {{ 'gap-4' if is_group_page else 'gap-4' }} text-sm">
        {% if current_user.is_authenticated %}
          <a href="/" class="px-3 py-2 font-semibold {% if is_dashboard_active %}text-purple-600{% else %}text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-white{% endif %}">Dashboard</a>
          <a href="/settings" class="px-3 py-2 font-semibold {% if is_settings_active %}text-purple-600{% else %}text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-white{% endif %}">Settings</a>
          {% if config.DEBUG %}
            <a href="/demo" class="px-3 py-2 font-semibold {% if is_demo_active %}text-purple-600{% else %}text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-white{% endif %}">Demo</a>
          {% endif %}
          {% if show_dev_console %}
            <a href="/debug" class="px-3 py-2 font-semibold {% if is_debug_active %}text-purple-600{% else %}text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-white{% endif %}">Dev Console</a>
          {% endif %}
          <div class="flex items-center gap-2 text-xs text-gray-500 dark:text-slate-400">
            {% if current_user.profile_pic_url %}
              <img src="{{ current_user.profile_pic_url }}" alt="Profile" class="w-7 h-7 rounded-full object-cover border border-purple-200 dark:border-purple-400/40"/>
            {% else %}
              <div class="w-7 h-7 rounded-full bg-purple-100 dark:bg-purple-500/20 flex items-center justify-center text-purple-600 dark:text-purple-300 font-semibold">
                {{ (current_user.display_name or current_user.name or "U")[0] }}
              </div>
            {% endif %}
            <span>Signed in as {{ current_user.username or current_user.display_name or current_user.name }}</span>
          </div>
          <a class="px-3 py-2 font-semibold text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-white" href="/auth/logout">Sign Out</a>
        {% else %}
          <a href="/" class="px-3 py-2 font-semibold text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-white">Home</a>
          {% if config.DEBUG %}
            <a href="/demo" class="px-3 py-2 font-semibold text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-white">Demo</a>
          {% endif %}
          {% if show_dev_console %}
            <a href="/debug" class="px-3 py-2 font-semibold text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-white">Dev Console</a>
          {% endif %}
          <a class="px-4 py-2 rounded-full bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold" href="/auth/login">Login with Google</a>
        {% endif %}
        <button id="themeToggle" class="p-2 rounded-full border border-gray-200 dark:border-slate-700 text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-white" type="button" aria-label="Toggle theme">
          <svg class="w-4 h-4 hidden" data-theme-icon="sun" viewBox="0 0 24 24" fill="none">
            <path d="M12 3v2M12 19v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M3 12h2M19 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41M12 7a5 5 0 100 10 5 5 0 000-10z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <svg class="w-4 h-4" data-theme-icon="moon" viewBox="0 0 24 24" fill="none">
            <path d="M21 14.5A8.5 8.5 0 119.5 3a7 7 0 0011.5 11.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <button id="mobileMenuToggle" class="md:hidden p-2 text-gray-700 dark:text-slate-200" aria-label="Open menu">
        <svg class="w-5 h-5" data-menu-icon="open" viewBox="0 0 24 24" fill="none">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <svg class="w-5 h-5 hidden" data-menu-icon="close" viewBox="0 0 24 24" fill="none">
          <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </nav>

    <div id="mobileMenu" class="md:hidden hidden bg-white dark:bg-slate-950 border-b border-gray-200 dark:border-slate-800">
      <div class="container mx-auto px-6 py-4 flex flex-col gap-4">
        {% if current_user.is_authenticated %}
          <a href="/" class="text-sm font-medium {% if is_dashboard_active %}text-purple-600{% else %}text-gray-900 dark:text-white{% endif %}">Dashboard</a>
          <a href="/settings" class="text-sm font-medium {% if is_settings_active %}text-purple-600{% else %}text-gray-900 dark:text-white{% endif %}">Settings</a>
          {% if config.DEBUG %}
            <a href="/demo" class="text-sm font-medium {% if is_demo_active %}text-purple-600{% else %}text-gray-900 dark:text-white{% endif %}">Demo</a>
          {% endif %}
          {% if show_dev_console %}
            <a href="/debug" class="text-sm font-medium {% if is_debug_active %}text-purple-600{% else %}text-gray-900 dark:text-white{% endif %}">Dev Console</a>
          {% endif %}
          <a class="text-sm font-medium text-gray-600 dark:text-slate-300" href="/auth/logout">Sign Out</a>
        {% else %}
          <a href="/" class="text-sm font-medium text-gray-900 dark:text-white">Home</a>
          {% if config.DEBUG %}
            <a href="/demo" class="text-sm font-medium text-gray-900 dark:text-white">Demo</a>
          {% endif %}
          {% if show_dev_console %}
            <a href="/debug" class="text-sm font-medium text-gray-900 dark:text-white">Dev Console</a>
          {% endif %}
          <a class="w-fit px-4 py-2 rounded-full bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold" href="/auth/login">Login with Google</a>
        {% endif %}
        <button id="themeToggleMobile" class="w-fit px-3 py-2 rounded-full border border-gray-200 dark:border-slate-700 text-gray-600 dark:text-slate-300" type="button">
          <span class="inline-flex items-center gap-2 text-sm font-medium">
            <svg class="w-4 h-4 hidden" data-theme-icon="sun" viewBox="0 0 24 24" fill="none">
              <path d="M12 3v2M12 19v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M3 12h2M19 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41M12 7a5 5 0 100 10 5 5 0 000-10z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <svg class="w-4 h-4" data-theme-icon="moon" viewBox="0 0 24 24" fill="none">
              <path d="M21 14.5A8.5 8.5 0 119.5 3a7 7 0 0011.5 11.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Toggle theme
          </span>
        </button>
      </div>
    </div>
  </header>

  <main class="pt-16">
    {% block content %}{% endblock %}
  </main>

  <div id="toastContainer" class="fixed bottom-6 right-6 z-50 flex flex-col gap-3"></div>

  <script type="module" src="/static/main.bundle.js"></script>
</body>
</html>
